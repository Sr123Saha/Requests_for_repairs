{% extends "base.html" %}

{% block title %}Редактирование заявки{% endblock %}
{% block header %}Редактирование заявки #{{ request_data.request_number }}{% endblock %}

{% block content %}
<h1>Редактирование заявки #{{ request_data.request_number }}</h1>
<p class="text-muted">Клиент: {{ request_data.client_fio }}</p>
{% if request_data.master_fio %}
<p class="text-muted">Мастер: {{ request_data.master_fio }}{% if request_data.master_phone %} (тел: {{ request_data.master_phone }}){% endif %}</p>
{% endif %}
<form method="post" class="mt-3" style="max-width: 600px;">
  {% if can_all %}
  <div class="mb-3">
    <label class="form-label">Заказчик</label>
    <select name="client_id" class="form-select" required>
      {% for c in clients %}
      <option value="{{ c.user_id }}" {% if c.user_id == request_data.client_id %}selected{% endif %}>{{ c.fio }}</option>
      {% endfor %}
    </select>
  </div>
  {% endif %}
  <div class="mb-3">
    <label class="form-label">Дата (ГГГГ-ММ-ДД)</label>
    <input type="date" name="start_date" class="form-control" value="{{ request_data.start_date }}" required>
  </div>
  {% if can_all or can_status %}
  <div class="mb-3">
    <label class="form-label">Тип оборудования</label>
    <input type="text" name="climate_tech_type" class="form-control" value="{{ request_data.climate_tech_type }}" required>
  </div>
  <div class="mb-3">
    <label class="form-label">Модель оборудования</label>
    <input type="text" name="climate_tech_model" class="form-control" value="{{ request_data.climate_tech_model }}" required>
  </div>
  {% endif %}
  <div class="mb-3">
    <label class="form-label">Описание проблемы</label>
    <textarea name="problem_description" class="form-control" rows="4" required>{{ request_data.problem_description }}</textarea>
  </div>
  {% if can_status or can_all %}
  <div class="mb-3">
    <label class="form-label">Статус</label>
    <select name="request_status" class="form-select" required>
      {% for status in statuses %}
      <option value="{{ status }}" {% if status == request_data.request_status %}selected{% endif %}>{{ status }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="mb-3">
    <label class="form-label">Дата завершения (ГГГГ-ММ-ДД)</label>
    <input type="date" name="completion_date" class="form-control" value="{{ request_data.completion_date or '' }}">
  </div>
  <div class="mb-3">
    <label class="form-label">Назначенный специалист</label>
    <select name="master_id" class="form-select">
      <option value="">-- не назначен --</option>
      {% for s in specialists %}
      <option value="{{ s.user_id }}" {% if s.user_id == request_data.master_id %}selected{% endif %}>{{ s.fio }}{% if s.phone %} ({{ s.phone }}){% endif %}</option>
      {% endfor %}
    </select>
  </div>
  {% endif %}
  <button type="submit" class="btn btn-primary">Сохранить</button>
  <a href="{{ url_for('requests_list') }}" class="btn btn-secondary">Отмена</a>
</form>
{% endblock %}

