{% extends "base.html" %}

{% block title %}Управление пользователями{% endblock %}
{% block header %}Управление пользователями{% endblock %}

{% block content %}
<h1>Управление пользователями</h1>
<p class="text-muted">Изменение ролей и статусов пользователей.</p>

<div class="table-responsive">
  <table class="table table-striped table-bordered">
    <thead>
      <tr>
        <th>ID</th>
        <th>ФИО</th>
        <th>Логин</th>
        <th>Текущая роль</th>
        <th>Статус</th>
        <th>Новая роль</th>
        <th>Изменить статус</th>
        <th>Действие</th>
      </tr>
    </thead>
    <tbody>
      {% for u in users %}
      <tr>
        <td>{{ u.user_id }}</td>
        <td>{{ u.fio }}</td>
        <td>{{ u.login }}</td>
        <td>
          <span class="badge bg-info">{{ u.user_type }}</span>
        </td>
        <td>
          {% if u.is_active %}
          <span class="badge bg-success">Активен</span>
          {% else %}
          <span class="badge bg-danger">Неактивен</span>
          {% endif %}
        </td>
        <td>
          <form method="post" action="{{ url_for('manage_users') }}" class="d-inline">
            <input type="hidden" name="user_id" value="{{ u.user_id }}">
            <div class="input-group input-group-sm">
              <select name="user_type" class="form-select form-select-sm">
                <option value="Заказчик" {% if u.user_type == 'Заказчик' %}selected{% endif %}>Заказчик</option>
                <option value="Специалист" {% if u.user_type == 'Специалист' %}selected{% endif %}>Специалист</option>
                <option value="Оператор" {% if u.user_type == 'Оператор' %}selected{% endif %}>Оператор</option>
              <option value="Менеджер" {% if u.user_type == 'Менеджер' %}selected{% endif %}>Менеджер</option>
              <option value="Менеджер по качеству" {% if u.user_type == 'Менеджер по качеству' %}selected{% endif %}>Менеджер по качеству</option>
              </select>
            </div>
        </td>
        <td>
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" name="is_active" value="1" 
                  {% if u.is_active %}checked{% endif %}>
            <label class="form-check-label">Активен</label>
          </div>
        </td>
        <td>
            <button type="submit" class="btn btn-sm btn-primary">Сохранить</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<a href="{{ url_for('requests_list') }}" class="btn btn-secondary">Назад к заявкам</a>
{% endblock %}